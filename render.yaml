databases:
  # Redis Cache for news, sessions, and rate limiting
  - name: tradesignal-redis
    plan: free  # or starter for 100MB
    region: oregon  # Match your web service region
    ipAllowList: []  # Internal access only

services:
  # Main API Web Service
  - type: web
    runtime: python
    name: tradesignal-api
    repo: https://github.com/skadri1601/TradeSignal
    branch: main
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: REDIS_URL
        fromDatabase:
          name: tradesignal-redis
          property: connectionString
    healthCheckPath: /health

  # Cron Job: Scrape Insider Trades (every 6 hours)
  - type: cron
    runtime: python
    name: tradesignal-scrape-insider
    repo: https://github.com/skadri1601/TradeSignal
    branch: main
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "0 */6 * * *"  # Every 6 hours
    startCommand: python scripts/cron_scrape.py --type insider --days 30
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: REDIS_URL
        fromDatabase:
          name: tradesignal-redis
          property: connectionString

  # Cron Job: Scrape Congressional Trades (every 12 hours)
  - type: cron
    runtime: python
    name: tradesignal-scrape-congressional
    repo: https://github.com/skadri1601/TradeSignal
    branch: main
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "0 0,12 * * *"  # At midnight and noon
    startCommand: python scripts/cron_scrape.py --type congressional --days 60
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: REDIS_URL
        fromDatabase:
          name: tradesignal-redis
          property: connectionString

  # Cron Job: Fetch Market News (every 2 hours)
  - type: cron
    runtime: python
    name: tradesignal-fetch-news
    repo: https://github.com/skadri1601/TradeSignal
    branch: main
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "0 */2 * * *"  # Every 2 hours
    startCommand: python scripts/cron_scrape.py --type news
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: REDIS_URL
        fromDatabase:
          name: tradesignal-redis
          property: connectionString
